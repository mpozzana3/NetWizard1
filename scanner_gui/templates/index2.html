+<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisi Dati</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Seleziona i parametri per l'analisi</h1>

    <form action="/submit_query" method="POST">
        <label for="table">Seleziona la Tabella:</label>
        <select name="table" id="table">
            <option value="">-- Seleziona Tabella --</option>
            {% for table in tabelle %}
                <option value="{{ table }}">{{ table }}</option>
            {% endfor %}
        </select><br><br>

        <label>Seleziona le Colonne (puoi selezionarne più di una):</label><br>
        <div id="column-container">
            <!-- Le checkbox verranno aggiunte dinamicamente -->
        </div><br>

        <label for="constraint">Inserisci un vincolo (opzionale):</label><br>
        <input type="text" id="constraint" name="constraint" placeholder="Es. id_scansione='1'"><br>
        <small>Ad esempio: id_scansione='1'</small><br><br>

        <button type="submit">Invia</button>
    </form>

    {% if query %}
        <h2>Query Eseguita:</h2>
        <pre>{{ query }}</pre>
    {% endif %}

    {% if response %}
        <h2>Risultato:</h2>
        <pre>{{ response }}</pre>
    {% endif %}

    <script>
        $(document).ready(function() {
            $('#table').change(function() {
                var tableName = $(this).val();
                if (tableName) {
                    $.ajax({
                        url: '/get_columns',
                        method: 'POST',
                        data: {table_name: tableName},
                        success: function(data) {
                            // Pulisci il contenitore delle checkbox
                            $('#column-container').empty();

                            // Aggiungi checkbox per ciascuna colonna
                            $('#column-container').append('<input type="checkbox" id="select-all" value="*" /> Seleziona tutte le colonne<br>');
                            data.forEach(function(column) {
                                $('#column-container').append(
                                    `<input type="checkbox" name="column" value="${column}" /> ${column}<br>`
                                );
                            });
                        }
                    });
                }
            });

            // Funzionalità per selezionare/deselezionare tutte le colonne
            $('#column-container').on('change', '#select-all', function() {
                var isChecked = $(this).prop('checked');
                $('#column-container input[type="checkbox"]').not('#select-all').prop('checked', isChecked);
            });
        });
    </script>
</body>
</html>
